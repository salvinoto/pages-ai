# Page-AI SDK

Page-AI enables AI agents to interact with web applications by providing a structured way to describe UI elements and actions, observe DOM changes, and execute commands. It aims to bridge the gap between AI models and the dynamic nature of web interfaces.

## Packages

This monorepo contains the following packages:

*   `@page-ai/core`: Core engine, command definitions, selector DSL, and Edge compatibility.
*   `@page-ai/dom`: DOM serialization and MutationObserver-based diffing.
*   `@page-ai/react`: React integration components and hooks.

## Installation

Install the necessary packages using your preferred package manager. For example, with Bun:

```bash
bun add @page-ai/react @page-ai/core @page-ai/dom
```

## Development Commands

This section details the scripts available in the root `package.json` for common development tasks:

*   **`bun run build`**: Builds all packages (`@page-ai/core`, `@page-ai/dom`, `@page-ai/react`) sequentially. This process compiles the source code (TypeScript) into distributable JavaScript files, typically placing them in the `dist` directory within each package.

*   **`bun run add-changeset`**: Initiates the [Changesets](https://github.com/changesets/changesets) workflow to document changes (e.g., bug fixes, new features) intended for the next release. It interactively prompts you to select the packages affected by your changes and provide a description. This creates a unique markdown file in the `.changeset` directory detailing the change.

*   **`bun run version`**: Consumes the markdown files generated by `bun run add-changeset`. It automatically calculates the next appropriate semantic version (SemVer) for each affected package based on the changesets, updates the `version` field in their respective `package.json` files, and updates the `CHANGELOG.md` file for each package.

*   **`bun run publish`**: Publishes the packages to the NPM registry. This command first executes the `bun run build` script to ensure the latest code is built. Then, it publishes only the packages that have been versioned (by `bun run version`) since the last publish. *Note: Requires you to be logged into NPM (`npm login`) with appropriate permissions.*

*   **`bun run dev`**: Currently a placeholder script (`echo "Starting dev..."`). This can be configured to run a specific development workflow, such as starting a local development server for a demo application, watching files for changes and rebuilding, or other common development tasks.

*   **`bun run lint`**: Runs ESLint across the entire monorepo (`.ts` and `.tsx` files). This checks the code for potential errors, enforces code style consistency, and helps maintain code quality according to the rules defined in the ESLint configuration (`.eslintrc.js`).

*   **`bun run test`**: Executes the Jest test suite for all packages. It looks for test files (typically `*.test.ts` or `*.test.tsx`) within each package and runs the tests defined within them, reporting the results.
## Release Process (Using Changesets)

This project uses [Changesets](https://github.com/changesets/changesets) to manage versioning, changelogs, and publishing. Follow these steps carefully to prepare and publish a new release:

1.  **Make Code Changes:** Implement your features, bug fixes, or other changes in the relevant package(s).
2.  **Ensure Quality (Recommended):**
    *   Run tests: `bun run test`
    *   Run the linter: `bun run lint`
    *   Address any failures before proceeding.
3.  **Document Changes:** For *each* distinct change that should appear in the changelog, run:
    ```bash
    bun run add-changeset
    ```
    *   Follow the prompts to select affected packages, choose the SemVer bump (patch, minor, major), and write a clear description for the changelog.
4.  **Commit Changesets:** Add the generated markdown files in the `.changeset` directory to Git:
    ```bash
    git add .changeset/
    git commit -m "docs: add changesets for upcoming release"
    ```
5.  **Version Packages:** Run the version command to consume changesets, update package versions, and generate changelogs:
    ```bash
    bun run version
    ```
    *   This updates `package.json` versions and `CHANGELOG.md` files based on the committed changesets.
    *   **Note on Internal Dependencies:** Use `"0.0.0"` as a placeholder version for internal monorepo dependencies (e.g., `"@page-ai/core": "0.0.0"` in `@page-ai/react`'s `package.json`). The `bun run version` command is designed to automatically replace these `"0.0.0"` placeholders with the correct fixed version (e.g., `^0.3.1`) of the dependency *if* that dependency is also being versioned in the same release.
    *   **Crucial:** This ensures that the correct, synchronized versions are written to `package.json` files before you commit and publish.
6.  **Review and Commit Versioning:**
    *   **VERIFY CHANGES:** Before committing, **manually inspect** the `dependencies` section in the relevant `package.json` files (e.g., `packages/react/package.json`). Confirm that `bun run version` has successfully replaced the `"0.0.0"` placeholders with actual version numbers (e.g., `^0.3.1`). **Do not proceed if they still say "0.0.0"!**
    *   Review the rest of the changes in `package.json` files and `CHANGELOG.md` files.
    *   Commit the verified changes:
        ```bash
        # Ensure you add ALL modified package.json and CHANGELOG.md files
        git add packages/*/package.json packages/*/CHANGELOG.md .changeset/pre.json
        git commit -m "chore: bump versions and update changelogs"
        ```
    *   **If verification fails** (placeholders weren't replaced), investigate potential issues with your Changesets setup or the `bun run version` execution before attempting to publish. Publishing with `"0.0.0"` or `workspace:*` will break installation for users.
7.  **Build Packages:** Ensure all packages are built with the latest code and correct version numbers before publishing:
    ```bash
    bun run build
    ```
8.  **Publish Packages (Manual):** Publish the newly versioned packages to NPM. This step requires you to be logged into NPM (`npm login`) with appropriate permissions.
    ```bash
    bunx changeset publish
    ```
9.  **Tag Release (Optional but Recommended):** Create and push a Git tag for the release.
    ```bash
    # Example: git tag @page-ai/core@0.1.1 # Tag specific package version
    # Example: git tag release-2025-05-05
    # git push origin <tag_name> # Or git push --tags
    ```

This structured process ensures accurate versioning, automated changelogs, and a clear separation between versioning (`bun run version`), building (`bun run build`), and publishing (`changeset publish`).