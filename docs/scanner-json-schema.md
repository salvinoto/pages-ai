# @page-ai/scanner JSON Output Schema

## 1. Introduction to the JSON Output

The `@page-ai/scanner` library scans a live DOM and produces a JSON output representing the interactive landscape of the page. This output is structured as a JSON array, where each object in the array is an `InteractiveElement` object.

This schema is designed for consumption by an AI agent's tool-calling interface, providing detailed information about each identified interactive element on a webpage.

## 2. `InteractiveElement` Object Definition

Each object in the output array represents an interactive element found on the page and has the following properties:

---

**Field Name:** `id`
**Data Type:** `string`
**Description:** A unique identifier generated by the scanner for this element within the current scanned set (e.g., "el-1", "el-hash-xyz"). This ID is guaranteed to be unique for each element in a single scan result.

---

**Field Name:** `selector`
**Data Type:** `string`
**Description:** A stable and unique CSS selector (or XPath, if a CSS selector is not sufficiently feasible or stable) that can be used to reliably re-select the element on the page. See "Selector Generation Strategy Considerations" below for more details.

---

**Field Name:** `elementType`
**Data Type:** `string`
**Description:** The HTML tag name of the element in lowercase (e.g., "input", "button", "a", "select").

---

**Field Name:** `elementId`
**Data Type:** `string | null`
**Description:** The value of the element's `id` attribute as defined in the HTML. If the element does not have an `id` attribute, this field will be `null`.

---

**Field Name:** `elementName`
**Data Type:** `string | null`
**Description:** The value of the element's `name` attribute as defined in the HTML. If the element does not have a `name` attribute, this field will be `null`.

---

**Field Name:** `currentValue`
**Data Type:** `string | null`
**Description:** The current value of the element, relevant for form controls.
*   For `<input>` elements (text, password, email, etc.) and `<textarea>`: `element.value`.
*   For `<select>`: The `value` of the currently selected `<option>`.
This field is `null` or not applicable for elements like non-input buttons or static links where "value" in this context doesn't apply.

---

**Field Name:** `href`
**Data Type:** `string | null`
**Description:** For `<a>` elements or other link-like elements, this field stores the resolved absolute URL from the `href` attribute. It represents the destination of the link. For non-link elements or links without an `href` (e.g., `<a>` tags used as buttons with JavaScript handlers), this will be `null`.

---

**Field Name:** `placeholder`
**Data Type:** `string | null`
**Description:** The value of the `placeholder` attribute, primarily for `<input>` and `<textarea>` elements. If the attribute is not present, this field will be `null`.

---

**Field Name:** `labelText`
**Data Type:** `string | null`
**Description:** The concatenated text content from any associated `<label>` elements. Association can be via the `for` attribute of the label pointing to the element's `id`, or by the element being a descendant of a label, or a label being a descendant of the element. If multiple labels are associated, their text content is concatenated (e.g., with a space). If no associated label is found, this field is `null`.

---

**Field Name:** `ariaLabel`
**Data Type:** `string | null`
**Description:** The value of the `aria-label` attribute on the element. If the attribute is not present, this field will be `null`.

---

**Field Name:** `ariaLabelledBy`
**Data Type:** `string | null`
**Description:** The value of the `aria-labelledby` attribute, which is a string of space-separated ID references. The scanner should ideally resolve these IDs to the text content of the referenced elements. This resolved text is a primary candidate for the `accessibleName`. If the attribute is not present, this field will be `null`.

---

**Field Name:** `ariaDescribedBy`
**Data Type:** `string | null`
**Description:** The value of the `aria-describedby` attribute, a string of space-separated ID references. The scanner should ideally resolve these IDs to the text content of the referenced elements to provide descriptive information. This resolved text can offer additional context to the AI. If the attribute is not present, this field will be `null`.

---

**Field Name:** `accessibleName`
**Data Type:** `string | null`
**Description:** The computed accessible name of the element, which is crucial for an AI to understand the element's purpose. It is derived using the following priority order:
1.  If `aria-labelledby` is present and its referenced element(s) have text content, use that resolved text.
2.  Else, if `aria-label` is present and has a non-empty value, use that.
3.  Else, if `labelText` is available (from an associated `<label>`), use that.
4.  Else, if the element itself has direct `textContent` that is not empty (common for `<button>`, `<a>`, etc.), use that.
5.  Else, if the element has a `title` attribute with a non-empty value, use that.
6.  If none of the above yield a name, this field may be `null`.
The text should be trimmed of leading/trailing whitespace.

---

**Field Name:** `textContent`
**Data Type:** `string | null`
**Description:** The direct `textContent` of the element itself, trimmed of leading/trailing whitespace. This is the raw text within the element, before considering labels or ARIA attributes for the `accessibleName`. Can be `null` if the element has no text content.

---

**Field Name:** `role`
**Data Type:** `string | null`
**Description:** The explicit ARIA `role` attribute value assigned to the element (e.g., "button", "link", "checkbox", "tab"). If no explicit `role` attribute is present, this field will be `null`.

---

**Field Name:** `isInteractiveBy`
**Data Type:** `string[]` (Array of strings)
**Description:** An array of strings indicating the reasons why this element was deemed interactive by the scanner. This helps understand the nature of its interactivity. Examples:
*   `"tag:button"` (for `<button>` elements)
*   `"tag:a[href]"` (for `<a>` elements with an `href`)
*   `"tag:input"` (for `<input>` elements, could be more specific like `"tag:input[type=text]"`)
*   `"aria-role:button"` (if an element has `role="button"`)
*   `"event:onclick"` (if an element has an `onclick` handler or a click event listener detected)
*   `"attr:contenteditable"` (if the element is contenteditable)

---

## 3. Selector Generation Strategy Considerations

Generating robust and unique selectors is critical for the AI to reliably re-target elements. The scanner should employ a strategy that prioritizes:
1.  **Unique `id` attribute:** If an element has a unique `id`, `#elementId` is preferred.
2.  **Stable and unique attributes:** Attributes like `name`, `data-test-id`, or other custom `data-*` attributes that are likely to be stable.
3.  **Combination of attributes and tag name:** e.g., `input[name="email"]`.
4.  **Text content (with caution):** For elements like buttons or links, if other methods fail, a selector based on text content might be used, but this is often brittle.
5.  **Positional/structural selectors:** Based on parent-child relationships (e.g., using `:nth-child`, `>` combinator), but these should be as shallow and stable as possible. Avoid overly long and complex paths.
6.  **XPath as a fallback:** If a stable CSS selector cannot be generated, XPath can offer more flexibility but can also be less readable.

The goal is to find the shortest, most stable, and unique selector. The scanner should avoid selectors based on highly dynamic attributes (e.g., auto-generated CSS classes, styles).

## 4. JSON Example

Here is an example of the JSON output for a few different types of interactive elements:

```json
[
  {
    "id": "el-1",
    "selector": "input#user-email",
    "elementType": "input",
    "elementId": "user-email",
    "elementName": "email",
    "currentValue": "test@example.com",
    "href": null,
    "placeholder": "Enter your email",
    "labelText": "Email Address:",
    "ariaLabel": null,
    "ariaLabelledBy": null,
    "ariaDescribedBy": "email-hint",
    "accessibleName": "Email Address:",
    "textContent": null,
    "role": null,
    "isInteractiveBy": ["tag:input[type=email]"]
  },
  {
    "id": "el-2",
    "selector": "button.btn-primary[data-action='submit']",
    "elementType": "button",
    "elementId": null,
    "elementName": "submit_form",
    "currentValue": null,
    "href": null,
    "placeholder": null,
    "labelText": null,
    "ariaLabel": "Submit Registration Form",
    "ariaLabelledBy": null,
    "ariaDescribedBy": null,
    "accessibleName": "Submit Registration Form",
    "textContent": "Register",
    "role": null,
    "isInteractiveBy": ["tag:button", "event:onclick"]
  },
  {
    "id": "el-3",
    "selector": "div > p > a[href='/terms']",
    "elementType": "a",
    "elementId": null,
    "elementName": null,
    "currentValue": null,
    "href": "/terms",
    "placeholder": null,
    "labelText": null,
    "ariaLabel": null,
    "ariaLabelledBy": null,
    "ariaDescribedBy": null,
    "accessibleName": "View Terms and Conditions",
    "textContent": "View Terms and Conditions",
    "role": "link",
    "isInteractiveBy": ["tag:a[href]", "aria-role:link"]
  },
  {
    "id": "el-4",
    "selector": "span[role='button'][aria-labelledby='save-label']",
    "elementType": "span",
    "elementId": null,
    "elementName": null,
    "currentValue": null,
    "href": null,
    "placeholder": null,
    "labelText": null,
    "ariaLabel": null,
    "ariaLabelledBy": "save-label",
    "ariaDescribedBy": null,
    "accessibleName": "Save Document",
    "textContent": "Save",
    "role": "button",
    "isInteractiveBy": ["aria-role:button", "event:onclick"]
  }
]
```

## 5. Opt-Out Mechanism

Elements can be excluded from the scan result, along with all their descendants, by adding the `data-ai-hide` attribute. The presence of this attribute (e.g., `data-ai-hide` or `data-ai-hide="true"`) on an element will cause the scanner to ignore it and its children.